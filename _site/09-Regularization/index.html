















<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2022-02-10 18:19:54 -0500">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/syntax.css" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>


    



    <!-- Favicons for everyone -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../assets/favicons/swc/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/favicons/swc/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/favicons/swc/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/favicons/swc/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../assets/favicons/swc/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../assets/favicons/swc/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../assets/favicons/swc/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../assets/favicons/swc/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="../assets/favicons/swc/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Software Carpentry - Introduction to Machine Learning using Python"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="../assets/favicons/swc/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="../assets/favicons/swc/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="../assets/favicons/swc/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="../assets/favicons/swc/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="../assets/favicons/swc/mstile-310x310.png" />


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

  <title>
  Regularization and Variable Selection &ndash; Introduction to Machine Learning using Python
  </title>

  </head>
  <body>

    


<div class="panel panel-default life-cycle">
  <div id="life-cycle" class="panel-body beta">
    This lesson is being piloted (Beta version)
  </div>
</div>




    <div class="container">
      
















  
  










<nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      <a href="https://www.palmetto.clemson.edu" class="pull-left">
        <img class="navbar-logo" src="../assets/img/clemson.png" alt="West Chester University logo" />
      </a>

      
      <a class="navbar-brand" href="../index.html">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

        
	
        <li><a href="../setup.html">Setup</a></li>

        
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            <li><a href="../01-introduction/index.html">Introduction to Machine Learning</a></li>
            
            
            <li><a href="../02-sklearn-preprocessing/index.html">Introduction to Scikit Learn</a></li>
            
            
            <li><a href="../03-sklearn-Data-Partition/index.html">Data Partition with Scikit-Learn</a></li>
            
            
            <li><a href="../04.sklearn-Evaluation-Metrics/index.html">Evaluation Metrics with Scikit-Learn</a></li>
            
            
            <li><a href="../05-Training_Regression/index.html">Training Machine Learning model using Regression Method</a></li>
            
            
            <li><a href="../06-Training_Tree/index.html">Training Machine Learning model using Tree-based model</a></li>
            
            
            <li><a href="../07-Training_Ensemble/index.html">Training Machine Learning model using Ensemble approach</a></li>
            
            
            <li><a href="../08-Model_Based/index.html">Training Machine Learning model using Model based Prediction</a></li>
            
            
            <li><a href="../09-Regularization/index.html">Regularization and Variable Selection</a></li>
            
            
            <li><a href="../10-Dimension-Reduction/index.html">Dimension Reduction</a></li>
            
            
            <li><a href="../11-Neural-Network/index.html">Neural Network</a></li>
            
            
            <li><a href="../12-Support%20Vector%20Machine/index.html">Support Vector Machine</a></li>
            
            
            <li><a href="../13-KNN/index.html">K-Nearest Neighbour</a></li>
            
            
            <li><a href="../14-Unsupervised-Learning/index.html">Unsupervised Learning</a></li>
            
            
            <li><a href="../15-Mini-Project/index.html">Mini-Project</a></li>
            
	    <li role="separator" class="divider"></li>
            <li><a href="../aio/index.html">All in one page (Beta)</a></li>
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="../reference.html">Reference</a></li>
            
            
            <li><a href="../Addon_DecisionTree/index.html">Detailed explanation on Decision Tree</a></li>
            
            
            <li><a href="../about/index.html">About</a></li>
            
            
            <li><a href="../figures/index.html">Figures</a></li>
            
            
            <li><a href="../guide/index.html">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../LICENSE.html">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>




























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../08-Model_Based/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
    <h3 class="maintitle"><a href="../">Introduction to Machine Learning using Python</a></h3>
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../10-Dimension-Reduction/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>

<article>
<div class="row">
  <div class="col-md-1">
  </div>
  <div class="col-md-10">
    <h1 class="maintitle">Regularization and Variable Selection</h1>
  </div>
  <div class="col-md-1">
  </div>
</div>












<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 20 min
      <br/>
      <strong>Exercises:</strong> 0 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>Why do we need Regularization and Variable Selection in ML model</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Learn how to apply Regularization and Variable selection in ML model</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p><img src="https://user-images.githubusercontent.com/43855029/114340188-ff57bc80-9b24-11eb-826a-69cb444687d4.png" alt="image" /></p>
<ul>
  <li>One of the major aspects of training your machine learning model is to avoid overfitting (Using more parameter to best fit the training but on the other hand, failed to evaluate the testing).</li>
  <li>The concept of balancing bias and variance, is helpful in understanding the phenomenon of overfitting</li>
</ul>

<h2 id="9-regularization">9 Regularization</h2>
<ul>
  <li>In order to reduce the Model Complexity or to avoid Multi-Collinearity, one needs to reduce the number of covariates 
(or set the coefficient to be zero).</li>
  <li>If the coefficients are too large, let’s penalize them to enforce them to be smaller</li>
  <li>Regularization is a form of multilinear regression, that constrains/regularizes or shrinks the coefficient estimates towards zero.</li>
  <li>In other words, this technique discourages learning a more complex or flexible model, so as to avoid the risk of overfitting</li>
  <li>A simple Multi-Linear Regression look like this:
<img src="https://user-images.githubusercontent.com/43855029/114416230-766d6f00-9b7e-11eb-800b-2b7a65782859.png" alt="image" /></li>
</ul>

<p>=&gt; in which: <strong>β</strong> represents the coefficient estimates for different variables or predictors(x)</p>

<p>The residual sum of squares <strong>RSS</strong> is the loss function of the fitting procedure.
And we need to determine the optimal coefficients <strong>𝛽</strong> to minimize the loss function</p>

<p><img src="https://user-images.githubusercontent.com/43855029/114417635-c39e1080-9b7f-11eb-8465-cbb9e0dff39e.png" alt="image" /></p>

<p>This procedure will adjust the <strong>β</strong> based on the training data. 
If there is any noise in training data, the model will not perform well for testing data. Thus, Regularization comes in and regularizes/shrinkage these 𝛽 towards zero.</p>

<p>There are 3 main types of Regularization.</p>
<ul>
  <li>Ridge Regression</li>
  <li>LASSO</li>
  <li>Elastics Nets</li>
</ul>

<h3 id="91-ridge-regression">9.1 Ridge Regression</h3>
<p><img src="https://user-images.githubusercontent.com/43855029/121278968-b496be80-c8a1-11eb-9117-250db80ca4d8.png" alt="image" /></p>

<p><strong>𝜆</strong>: Regularization Penalty, to be selected that the model minimized the error</p>

<p>The Ridge Regression loss function contains 2 elements: (1) RSS is actually the Ordinary Least Square (OLS) function for MLR and (2) The regularization term with <strong>𝜆</strong>:</p>

<p><img src="https://user-images.githubusercontent.com/43855029/121278778-4fdb6400-c8a1-11eb-9141-46d995d07061.png" alt="image" /></p>

<ul>
  <li>Selecting good <strong>𝜆</strong> is essential. In this case, Cross Validation method should be used</li>
  <li>Ridge Regression enforces <strong>β</strong> to be lower but not 0. By doing so, it will not get rid of irrelevant features but rather minimize their impact on the trained model.</li>
  <li>In statistics the coefficient esimated produced by this method is know as <strong>L2 norm</strong></li>
  <li>It is good practice to normalize predictors to the same scale before performing Ridge Regression (Because in OLS, the coefficients are scale equivalent)</li>
</ul>

<h4 id="911-implementation">9.1.1 Implementation</h4>
<p>Setting up training/testing model using the Stanford’s <a href="https://web.stanford.edu/~hastie/ElemStatLearn/datasets/prostate.data">prostate cancer data</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/vuminhtue/Machine-Learning-Python/master/data/prostate_data.csv"</span><span class="p">)</span>
<span class="n">ind_train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"train"</span><span class="p">]</span><span class="o">==</span><span class="s">"T"</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"train"</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"lpsa"</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">ind_train</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"lpsa"</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">~</span><span class="n">ind_train</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"lpsa"</span><span class="p">][</span><span class="n">ind_train</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"lpsa"</span><span class="p">][</span><span class="o">~</span><span class="n">ind_train</span><span class="p">]</span>
</code></pre></div></div>

<p>Predict using Ridge Regression method and Cross Validation approach:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeCV</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span> <span class="k">as</span> <span class="n">mse</span>

<span class="n">n_lambda</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span>

<span class="n">MSE_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">ld</span> <span class="ow">in</span> <span class="n">lambdas</span><span class="p">:</span>
    <span class="n">ridgecv</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span> <span class="o">=</span> <span class="p">[</span><span class="n">ld</span><span class="p">],</span> <span class="n">normalize</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">model_RR</span> <span class="o">=</span> <span class="n">ridgecv</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_predRR_cv_train</span> <span class="o">=</span> <span class="n">model_RR</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">y_predRR_cv_test</span>  <span class="o">=</span> <span class="n">model_RR</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    
    <span class="n">MSE_train</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_predRR_cv_train</span><span class="p">))</span>
    <span class="n">MSE_test</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_predRR_cv_test</span><span class="p">))</span>    
    <span class="n">coefs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_RR</span><span class="p">.</span><span class="n">coef_</span><span class="p">)</span>

<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
<span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">.</span><span class="n">columns</span>
</code></pre></div></div>

<p>Plotting the Mean Square Error for Training and Testing dataset based on <strong>𝜆</strong> variation</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">MSE_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Training Set"</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">MSE_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Testing Set"</span><span class="p">)</span>

<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MSE'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MSE'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="https://user-images.githubusercontent.com/43855029/115435103-7bae6780-a1d7-11eb-995b-31a69408469e.png" alt="image" /></p>

<p>Plotting the coefficient of different predictors based on <strong>𝜆</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gca</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">size</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas</span><span class="p">),</span> <span class="n">coef_df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
<span class="c1">#ax.set_xscale('log')
</span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Coefficients'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Ridge Regression Coefficients'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/43855029/121300671-259b9d80-c8c5-11eb-8d65-8abf3ba5632f.png" alt="image" /></p>

<p>The plot shows different coefficients for all predictors with <strong>𝜆</strong> variation.</p>

<ul>
  <li>Ridge Regression’s pros: the pros of RR method over OLS is rooted in the bias variance trade-off. As when <strong>𝜆</strong> increases, the flexibility of RR fit decreases, hence decrease the variance but increase the bias</li>
  <li>Ridge Regression’s cons: <strong>β</strong> never be 0, so all predictors are included in the final model. Therefore, it is not good for best feature selection.</li>
</ul>

<h3 id="92-lasso-least-absolute-shrinkage--selection-operator">9.2 LASSO: Least Absolute Shrinkage &amp; Selection Operator</h3>
<p><img src="https://user-images.githubusercontent.com/43855029/121297875-f5ea9680-c8c0-11eb-96c7-b52291a7adbc.png" alt="image" /></p>

<ul>
  <li>In order to overcome the cons issue in Ridge Regression, the LASSO is introduced with the similar shrinkage parameter, but the different is not in square term of the coefficient but only absolute value</li>
  <li>Similar to Ridge Regression, LASSO also shrink the coefficient, but <strong>force</strong> coefficients to be equal to 0. Making it ability to perform <strong>feature selection</strong></li>
  <li>In statistics the coefficient esimated produced by this method is know as <strong>L1 norm</strong></li>
</ul>

<h4 id="921-implementation">9.2.1 Implementation</h4>
<p>Predict using Lasso method:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>

<span class="n">n_lambda</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">lambdas1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_lambda</span><span class="p">)</span>

<span class="n">MSE_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ld</span> <span class="ow">in</span> <span class="n">lambdas1</span><span class="p">:</span>
    <span class="n">lassocv</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">ld</span><span class="p">)</span>
    <span class="n">model_LS</span> <span class="o">=</span> <span class="n">lassocv</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_predLS_cv_train</span> <span class="o">=</span> <span class="n">model_LS</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">y_predLS_cv_test</span> <span class="o">=</span> <span class="n">model_LS</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">MSE_train</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_predLS_cv_train</span><span class="p">))</span>
    <span class="n">MSE_test</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_predLS_cv_test</span><span class="p">))</span>
    <span class="n">coefs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_LS</span><span class="p">.</span><span class="n">coef_</span><span class="p">)</span>    
</code></pre></div></div>
<p>Plotting the Mean Square Error for Training and Testing dataset based on <strong>𝜆</strong> variation</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas1</span><span class="p">),</span> <span class="n">MSE_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Training Set"</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas1</span><span class="p">),</span> <span class="n">MSE_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">"Testing Set"</span><span class="p">)</span>

<span class="n">ax1</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MSE'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'MSE'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>
<p><img src="https://user-images.githubusercontent.com/43855029/115447429-80c6e300-a1e6-11eb-8808-d44145b77e5f.png" alt="image" /></p>

<p>Plotting the coefficient of different predictors based on <strong>𝜆</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
<span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">.</span><span class="n">columns</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">gca</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="n">size</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lambdas1</span><span class="p">),</span> <span class="n">coef_df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">coef_df</span><span class="p">.</span><span class="n">columns</span><span class="p">,</span><span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>
<span class="c1">#ax.set_xscale('log')
</span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"log($</span><span class="se">\\</span><span class="s">lambda$)"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Coefficients'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'LASSO Coefficients'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'tight'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="https://user-images.githubusercontent.com/43855029/121300854-5da2e080-c8c5-11eb-9eec-00c42b39dcbf.png" alt="image" /></p>

<p>The plot shows different coefficients for all predictors with <strong>𝜆</strong> variation. Depending on <strong>𝜆</strong> values that the <strong>β</strong> varying and it can be 0 at certain point.</p>

<h3 id="93-elastic-nets">9.3 Elastic Nets</h3>
<p>Elastic Nets Regularization is a method that includes both LASSO and Ridge Regression. Its formulation for the loss function is as following:
<img src="https://user-images.githubusercontent.com/43855029/114456877-615b0500-9bab-11eb-9298-028fcffc03ab.png" alt="image" /></p>

<ul>
  <li>𝛼=0: pure Ridge Regression</li>
  <li>𝛼=1: pure LASSO</li>
  <li>0&lt;𝛼&lt;1: Elastic Nets</li>
</ul>

<h4 id="931-implementation">9.3.1 Implementation</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span>

<span class="n">MSE_train</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_test</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ld</span> <span class="ow">in</span> <span class="n">lambdas1</span><span class="p">:</span>
    <span class="n">Elastic_cv</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">ld</span><span class="p">,</span><span class="n">l1_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">model_EN</span> <span class="o">=</span> <span class="n">Elastic_cv</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_predEN_cv_train</span> <span class="o">=</span> <span class="n">model_EN</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">y_predEN_cv_test</span> <span class="o">=</span> <span class="n">model_EN</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">MSE_train</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_predEN_cv_train</span><span class="p">))</span>
    <span class="n">MSE_test</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_predEN_cv_test</span><span class="p">))</span>
    <span class="n">coefs</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_EN</span><span class="p">.</span><span class="n">coef_</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>The ElasticNet mixing parameter, with <strong>0 &lt;= l1_ratio &lt;= 1.</strong></li>
  <li>For <strong>l1_ratio = 0</strong> the penalty is an L2 penalty (<strong>Ridge Regression</strong>).</li>
  <li>For <strong>l1_ratio = 1</strong> it is an L1 penalty (<strong>LASSO</strong>).</li>
  <li>For <strong>0 &lt; l1_ratio &lt; 1</strong>, the penalty is a combination of L1 and L2.</li>
</ul>






<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Regularization, Ridge Regression, LASSO, Elastic Nets</p>
</li>
    
  </ul>
</blockquote>

</article>



























  
  











<div class="row">
  <div class="col-xs-1">
    <h3 class="text-left">
      
      <a href="../08-Model_Based/index.html"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-xs-10">
    
  </div>
  <div class="col-xs-1">
    <h3 class="text-right">
      
      <a href="../10-Dimension-Reduction/index.html"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>



<!--  
      






<footer>
  <div class="row">
    <div class="col-md-6 copyright" align="left">
	
	Licensed under <a href="">CC-BY 4.0</a> 2018–2022
	by <a href="">The Carpentries</a>
        <br>
        Licensed under <a href="">CC-BY 4.0</a> 2016–2018
	by <a href="">Software Carpentry Foundation</a>
	
    </div>
  </div>
  <div class="row">
    <div class="col-md-12" align="center">
      Using <a href="https://github.com/carpentries/styles/">The Carpentries style</a>
      version <a href="https://github.com/carpentries/styles/releases/tag/v9.5.3">9.5.3</a>.
    </div>
  </div>
</footer>

       -->
    </div>
    
<script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
